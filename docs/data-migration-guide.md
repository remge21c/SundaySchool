# 데이터 마이그레이션 가이드

> 기존 종이/엑셀 데이터를 시스템에 입력하는 방법

---

## 목차

1. [개요](#개요)
2. [데이터 준비](#데이터-준비)
3. [수동 입력 방법](#수동-입력-방법)
4. [일괄 업로드 (향후 기능)](#일괄-업로드-향후-기능)
5. [데이터 검증](#데이터-검증)

---

## 개요

기존 종이 교적부나 엑셀 파일의 데이터를 새로운 시스템으로 마이그레이션하는 방법을 설명합니다.

현재 MVP 버전에서는 **수동 입력**을 권장합니다. 파일럿 단계에서 데이터량이 많지 않으므로, 이 방법이 가장 안전하고 정확합니다.

---

## 데이터 준비

### 필요 데이터 목록

마이그레이션하기 전에 다음 데이터를 준비하세요:

#### 1. 반(Class) 정보
- 부서 (예: 유년부, 초등부, 중등부, 고등부)
- 반 이름 (예: 1반, 2반)
- 학년도 (예: 2026)
- 담임 교사 (이메일 또는 이름)

#### 2. 학생 정보
- 이름
- 학년
- 생년월일
- 성별 (남/여)
- 보호자 연락처
- 주소
- 학교명
- 알레르기 정보 (있는 경우)

#### 3. 교사 정보
- 이름
- 이메일 (로그인 ID로 사용)
- 비밀번호
- 담당 부서/반

---

## 수동 입력 방법

### 1단계: 관리자 계정 생성

프로덕션 환경에 로그인할 수 있는 관리자 계정을 생성합니다.

**방법 1: 스크립트 사용 (권장)**

```bash
npm run create-admin
```

스크립트 실행 시:
- 이메일 입력
- 비밀번호 입력 (4자 이상)
- 자동으로 관리자 계정 및 프로필 생성

**방법 2: Supabase 대시보드**

1. Supabase 대시보드 → **Authentication** → **Users**
2. **Add user** → **Create new user**
3. 이메일과 비밀번호 입력
4. **Table Editor** → **profiles** 테이블 열기
5. 해당 사용자의 `role`을 `admin`으로 수정

### 2단계: 교사 계정 생성

각 교사에 대한 계정을 생성합니다.

1. **웹 애플리케이션에서:**
   - 관리자로 로그인
   - (향후 기능: 사용자 관리 페이지에서 교사 계정 생성)

2. **Supabase 대시보드에서:**
   - Authentication → Users → Add user
   - 각 교사의 이메일과 임시 비밀번호 입력
   - 생성 후 비밀번호를 교사에게 전달

### 3단계: 반(Class) 데이터 입력

현재는 Supabase 대시보드에서 직접 입력하거나, SQL을 사용합니다.

**Supabase 대시보드 방법:**

1. Supabase 대시보드 → **Table Editor** → **classes**
2. **Insert row** 클릭
3. 다음 정보 입력:
   - `name`: 반 이름 (예: "1반")
   - `department`: 부서 (예: "유년부")
   - `year`: 학년도 (예: 2026)
   - `main_teacher_id`: 담임 교사 ID (profiles 테이블에서 확인)
4. **Save** 클릭

**SQL 방법 (빠른 일괄 입력):**

1. Supabase 대시보드 → **SQL Editor**
2. 다음 SQL 실행 (값을 실제 데이터로 변경):

```sql
-- 반 데이터 일괄 입력 예시
INSERT INTO classes (name, department, year, main_teacher_id)
VALUES
  ('1반', '유년부', 2026, 'teacher-id-1'),
  ('2반', '유년부', 2026, 'teacher-id-2'),
  ('1반', '초등부', 2026, 'teacher-id-3');
```

### 4단계: 학생 데이터 입력

**Supabase 대시보드 방법:**

1. Supabase 대시보드 → **Table Editor** → **students**
2. **Insert row** 클릭
3. 다음 정보 입력:
   - `name`: 학생 이름
   - `grade`: 학년 (숫자)
   - `birthday`: 생년월일 (YYYY-MM-DD)
   - `gender`: 성별 ('M' 또는 'F')
   - `parent_contact`: 보호자 연락처
   - `address`: 주소
   - `school_name`: 학교명
   - `class_id`: 반 ID (classes 테이블에서 확인)
   - `allergies`: 알레르기 정보 (JSON 형식, 선택)
4. **Save** 클릭

**알레르기 정보 입력 (JSON 형식):**

```json
{
  "food": ["우유", "계란"],
  "medicine": [],
  "other": "없음"
}
```

---

## 일괄 업로드 (향후 기능)

파일럿 성공 후 v2에서 다음 기능을 추가할 예정입니다:

- 엑셀 파일 업로드
- CSV 파일 업로드
- 데이터 검증 및 오류 리포트

현재는 수동 입력을 사용해 주세요.

---

## 데이터 검증

### 입력 데이터 확인 체크리스트

데이터 입력 후 다음을 확인하세요:

- [ ] 모든 반이 올바르게 생성되었는지
- [ ] 모든 학생이 올바른 반에 할당되었는지
- [ ] 학생 정보 (이름, 학년, 연락처)가 정확한지
- [ ] 교사 계정이 올바르게 생성되었는지
- [ ] 담임 교사가 올바른 반에 할당되었는지

### 데이터 확인 방법

1. **웹 애플리케이션에서:**
   - 로그인 후 출석 체크 페이지 접속
   - 반 선택 트리에서 모든 반이 보이는지 확인
   - 각 반을 선택하여 학생 목록이 올바르게 표시되는지 확인

2. **Supabase 대시보드에서:**
   - Table Editor에서 각 테이블 확인
   - 데이터 개수 및 내용 검증

---

## 문제 해결

### 데이터 입력 오류

- **외래 키 제약 오류**: 참조하는 ID가 존재하는지 확인 (예: class_id, main_teacher_id)
- **필수 필드 누락**: 모든 필수 필드가 입력되었는지 확인
- **데이터 형식 오류**: 날짜 형식 (YYYY-MM-DD), 성별 ('M'/'F') 등 확인

### 데이터 수정/삭제

- Supabase 대시보드 → Table Editor에서 직접 수정/삭제 가능
- (향후 기능: 웹 애플리케이션에서 관리 기능 추가 예정)

---

## 다음 단계

데이터 입력이 완료되면:

1. [관리자 매뉴얼](./admin-manual.md) 참조
2. [교사용 사용 가이드](./user-guide.md) 참조
3. 파일럿 사용자에게 계정 및 사용법 안내
