# í•™ìƒ ê³ ìœ  ì‹ë³„ì ì„¤ê³„ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ê°œìš”](#ê°œìš”)
2. [í•™ì ë²ˆí˜¸ ì²´ê³„ ì„¤ê³„ ì˜µì…˜](#í•™ì ë²ˆí˜¸-ì²´ê³„-ì„¤ê³„-ì˜µì…˜)
3. [ê¶Œì¥ ë°©ì‹ ë° êµ¬í˜„](#ê¶Œì¥-ë°©ì‹-ë°-êµ¬í˜„)
4. [UI í‘œì‹œ ë°©ë²•](#ui-í‘œì‹œ-ë°©ë²•)
5. [í•™ì ë²ˆí˜¸ ë°œê¸‰ í”„ë¡œì„¸ìŠ¤](#í•™ì ë²ˆí˜¸-ë°œê¸‰-í”„ë¡œì„¸ìŠ¤)
6. [ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ](#ë³´ì•ˆ-ë°-í”„ë¼ì´ë²„ì‹œ)
7. [í†µê³„ í™œìš©](#í†µê³„-í™œìš©)

---

## ê°œìš”

### í•µì‹¬ ë¬¸ì œ

**ë¬¸ì œ:** ì´ë¦„ë§Œìœ¼ë¡œëŠ” í•™ìƒì„ êµ¬ë¶„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ë™ëª…ì´ì¸ (ê¹€ì² ìˆ˜ê°€ 2ëª…)
- ê°œëª… (ì´ì˜í¬ â†’ ì´ìˆ˜ì§„)
- ì˜¤íƒ€ ë° ë„ì–´ì“°ê¸° (ê¹€ ì² ìˆ˜ vs ê¹€ì² ìˆ˜)

**í•´ê²°ì±…:** êµíšŒ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•  **ê³ ìœ  í•™ì ë²ˆí˜¸(Student ID)** ì²´ê³„ í•„ìš”

### ì‹ë³„ìì˜ ì¡°ê±´

ì¢‹ì€ í•™ì ë²ˆí˜¸ ì‹œìŠ¤í…œì€:
- âœ… ì¤‘ë³µ ë¶ˆê°€ëŠ¥ (ìœ ì¼ì„±)
- âœ… ì˜êµ¬ ë¶ˆë³€ (ì•ˆì •ì„±)
- âœ… ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆìŒ (ê°€ë…ì„±)
- âœ… ë°œìŒí•˜ê¸° ì‰¬ì›€ (ì‹¤ìš©ì„±)
- âœ… ìë™ ìƒì„± ê°€ëŠ¥ (íš¨ìœ¨ì„±)

---

## í•™ì ë²ˆí˜¸ ì²´ê³„ ì„¤ê³„ ì˜µì…˜

### ì˜µì…˜ 1: ìˆœì°¨ë²ˆí˜¸ (Simple Sequential) â­â­â­â­â­ ê¶Œì¥

```
í˜•ì‹: S + 5ìë¦¬ ìˆ«ì
ì˜ˆì‹œ: S00001, S00002, S00003, ...

íŠ¹ì§•:
âœ… ê°„ë‹¨í•˜ê³  ì§ê´€ì 
âœ… ì¤‘ë³µ ë¶ˆê°€ëŠ¥
âœ… ì‹œìŠ¤í…œì—ì„œ ìë™ ìƒì„± ê°€ëŠ¥
âœ… ë°œìŒí•˜ê¸° ì‰¬ì›€
âŒ ì •ë³´ ì—†ìŒ (ì—°ë„, ë¶€ì„œ ë“±)

ì í•©í•œ ê²½ìš°:
- í•™ìƒ ìˆ˜ 100~500ëª… ê·œëª¨
- ê°„ë‹¨í•œ ê´€ë¦¬ë¥¼ ì›í•˜ëŠ” ê²½ìš°
- ë¹ ë¥¸ êµ¬í˜„ì´ í•„ìš”í•œ ê²½ìš°
```

### ì˜µì…˜ 2: ì—°ë„ + ìˆœë²ˆ (Year-Based) â­â­â­â­

```
í˜•ì‹: ì…í•™ì—°ë„(2ìë¦¬) + ìˆœë²ˆ(3ìë¦¬)
ì˜ˆì‹œ: 25001, 25002, 24001, 23015

íŠ¹ì§•:
âœ… ì…í•™ ì—°ë„ íŒŒì•… ê°€ëŠ¥
âœ… ì–´ëŠ ì •ë„ ì¤‘ë³µ ë°©ì§€
âš ï¸ ì—°ë„ë³„ ìˆœë²ˆ ê´€ë¦¬ í•„ìš”
âŒ ë§¤ë…„ 001ë¶€í„° ë‹¤ì‹œ ì‹œì‘

ì í•©í•œ ê²½ìš°:
- ì…í•™ ì—°ë„ êµ¬ë¶„ì´ ì¤‘ìš”í•œ ê²½ìš°
- í•™ìƒ ìˆ˜ê°€ ë§ì€ ê²½ìš° (500ëª…+)
```

### ì˜µì…˜ 3: ë¶€ì„œ + ì—°ë„ + ìˆœë²ˆ (Department-Year-Based) â­â­â­

```
í˜•ì‹: ë¶€ì„œì½”ë“œ(1ìë¦¬) + ì…í•™ì—°ë„(2ìë¦¬) + ìˆœë²ˆ(3ìë¦¬)
ì˜ˆì‹œ: E25001, M24015, Y23008

ë¶€ì„œì½”ë“œ:
- Y: ì˜ì•„ë¶€ (Infant)
- K: ìœ ì•„ë¶€ (Kindergarten)
- E: ìœ ë…„ë¶€ (Elementary)
- M: ì¤‘ë“±ë¶€ (Middle)
- H: ê³ ë“±ë¶€ (High)

íŠ¹ì§•:
âœ… ë¶€ì„œ ì¦‰ì‹œ íŒŒì•…
âœ… ì…í•™ ì—°ë„ íŒŒì•…
âœ… ì²´ê³„ì  ê´€ë¦¬
âŒ ë¶€ì„œ ì´ë™ ì‹œ í˜¼ë€ ê°€ëŠ¥
âŒ ê°€ì¥ ë³µì¡í•¨

ì í•©í•œ ê²½ìš°:
- ë¶€ì„œ ê°„ ëª…í™•í•œ êµ¬ë¶„ì´ í•„ìš”í•œ ê²½ìš°
- ëŒ€ê·œëª¨ êµíšŒ (1000ëª…+)
```

### ì˜µì…˜ 4: UUID ê¸°ë°˜ (Technical) âŒ ë¹„ì¶”ì²œ

```
í˜•ì‹: UUID (36ìë¦¬)
ì˜ˆì‹œ: 550e8400-e29b-41d4-a716-446655440000

íŠ¹ì§•:
âœ… ê¸€ë¡œë²Œí•˜ê²Œ ì¤‘ë³µ ë¶ˆê°€ëŠ¥
âœ… ë¶„ì‚° ì‹œìŠ¤í…œì— ì í•©
âŒ ì‚¬ëŒì´ ì½ì„ ìˆ˜ ì—†ìŒ
âŒ êµíšŒ í˜„ì¥ì—ì„œ ì‚¬ìš© ë¶ˆê°€ëŠ¥
âŒ ë°œìŒ ë¶ˆê°€ëŠ¥

ì í•©í•œ ê²½ìš°:
- ë‚´ë¶€ ì‹œìŠ¤í…œ IDë¡œë§Œ ì‚¬ìš©
- í•™ì ë²ˆí˜¸ë¡œëŠ” ë¶€ì í•©
```

---

## ê¶Œì¥ ë°©ì‹ ë° êµ¬í˜„

### ğŸ† ì¶”ì²œ: ìˆœì°¨ë²ˆí˜¸ ë°©ì‹ (S00001)

#### ì„ íƒ ì´ìœ 
1. âœ… **ê°€ì¥ ê°„ë‹¨í•¨** - êµ¬í˜„ ë° ê´€ë¦¬ ìš©ì´
2. âœ… **ì˜êµ¬ ë¶ˆë³€** - ë¶€ì„œ ì´ë™í•´ë„ ë²ˆí˜¸ ìœ ì§€
3. âœ… **ë°œìŒ ì‰¬ì›€** - "ì—ìŠ¤ê³µê³µê³µì‚¬ì´" (ì „í™”ë¡œ ë§í•˜ê¸° ì‰¬ì›€)
4. âœ… **í™•ì¥ì„±** - 99,999ëª…ê¹Œì§€ ìˆ˜ìš© (êµíšŒ ê·œëª¨ì— ì¶©ë¶„)
5. âœ… **ì¤‘ë³µ ë¶ˆê°€ëŠ¥** - ì‹œí€€ìŠ¤ë¡œ ìë™ ìƒì„±

### ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

```sql
-- 1. students í…Œì´ë¸” ì„¤ê³„
CREATE TABLE students (
  -- ì‹œìŠ¤í…œ ë‚´ë¶€ ID (ì ˆëŒ€ ë³€ê²½ ì•ˆ ë¨)
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- í•™ì ë²ˆí˜¸ (ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ê³ ìœ  ID)
  student_number TEXT UNIQUE NOT NULL, -- 'S00001'
  
  -- ê¸°ë³¸ ì •ë³´
  name TEXT NOT NULL,
  name_english TEXT, -- ì˜ë¬¸ ì´ë¦„ (ì„ íƒ)
  birthday DATE,
  gender TEXT CHECK (gender IN ('male', 'female')),
  
  -- ì¶”ê°€ ì‹ë³„ ì •ë³´
  parent_contact TEXT, -- í•™ë¶€ëª¨ ì „í™”ë²ˆí˜¸ (ì•”í˜¸í™”)
  initial_registration_date DATE DEFAULT CURRENT_DATE,
  
  -- í˜„ì¬ ìƒíƒœ
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_students_number ON students(student_number);
CREATE INDEX idx_students_name ON students(name);
CREATE INDEX idx_students_active ON students(is_active) WHERE is_active = true;
```

### ìë™ ìƒì„± ì‹œìŠ¤í…œ

```sql
-- 1. ì‹œí€€ìŠ¤ ìƒì„±
CREATE SEQUENCE student_number_seq START WITH 1;

-- 2. í•™ì ë²ˆí˜¸ ìƒì„± í•¨ìˆ˜
CREATE OR REPLACE FUNCTION generate_student_number()
RETURNS TEXT AS $$
DECLARE
  next_num INTEGER;
  new_number TEXT;
BEGIN
  next_num := nextval('student_number_seq');
  new_number := 'S' || LPAD(next_num::TEXT, 5, '0');
  RETURN new_number;
END;
$$ LANGUAGE plpgsql;

-- 3. íŠ¸ë¦¬ê±°ë¡œ ìë™ ë¶€ì—¬
CREATE OR REPLACE FUNCTION set_student_number()
RETURNS TRIGGER AS $$
BEGIN
  IF NEW.student_number IS NULL THEN
    NEW.student_number := generate_student_number();
  END IF;
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER auto_student_number
  BEFORE INSERT ON students
  FOR EACH ROW
  EXECUTE FUNCTION set_student_number();
```

### ì—°ë„ ê¸°ë°˜ ë°©ì‹ êµ¬í˜„ (ëŒ€ì•ˆ)

```sql
-- ì—°ë„ë³„ ìˆœë²ˆ ìƒì„± í•¨ìˆ˜
CREATE OR REPLACE FUNCTION generate_year_based_student_number()
RETURNS TEXT AS $$
DECLARE
  current_year TEXT;
  next_num INTEGER;
  new_number TEXT;
BEGIN
  -- í˜„ì¬ ì—°ë„ì˜ ë§ˆì§€ë§‰ 2ìë¦¬
  current_year := RIGHT(EXTRACT(YEAR FROM NOW())::TEXT, 2);
  
  -- í•´ë‹¹ ì—°ë„ì˜ í•™ìƒ ìˆ˜ ì¡°íšŒ
  SELECT COUNT(*) + 1 INTO next_num
  FROM students
  WHERE student_number LIKE current_year || '%';
  
  new_number := current_year || LPAD(next_num::TEXT, 3, '0');
  RETURN new_number;
END;
$$ LANGUAGE plpgsql;
```

---

## UI í‘œì‹œ ë°©ë²•

### 1. í•™ìƒ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸

```typescript
// components/StudentCard.tsx
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';

export function StudentCard({ student }) {
  return (
    <Card>
      <CardHeader>
        <div className="flex items-center gap-3">
          <Avatar>
            <AvatarImage src={student.profile_photo_url} />
            <AvatarFallback>{student.name[0]}</AvatarFallback>
          </Avatar>
          
          <div>
            <CardTitle>{student.name}</CardTitle>
            <CardDescription>
              í•™ì ë²ˆí˜¸: {student.student_number}
            </CardDescription>
          </div>
        </div>
      </CardHeader>
      
      <CardContent>
        <div className="space-y-2 text-sm">
          <div className="flex justify-between">
            <span className="text-gray-500">ìƒë…„ì›”ì¼</span>
            <span>{formatDate(student.birthday)}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-500">í˜„ì¬ ë°˜</span>
            <span>{student.current_class?.name}</span>
          </div>
          <div className="flex justify-between">
            <span className="text-gray-500">ì¶œì„ë¥ </span>
            <span className="font-semibold">{student.attendance_rate}%</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

### 2. ê²€ìƒ‰ ê¸°ëŠ¥

```typescript
// app/students/search/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { Input } from '@/components/ui/input';
import { supabase } from '@/lib/supabase/client';

export default function StudentSearch() {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  
  const searchStudents = async (q: string) => {
    if (!q) {
      setResults([]);
      return;
    }
    
    // í•™ì ë²ˆí˜¸ ë˜ëŠ” ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰
    const { data } = await supabase
      .from('students')
      .select('*')
      .or(`student_number.ilike.%${q}%,name.ilike.%${q}%`)
      .eq('is_active', true)
      .limit(10);
    
    setResults(data || []);
  };
  
  useEffect(() => {
    const timer = setTimeout(() => {
      searchStudents(query);
    }, 300); // ë””ë°”ìš´ìŠ¤
    
    return () => clearTimeout(timer);
  }, [query]);
  
  return (
    <div className="space-y-4">
      <Input
        placeholder="ì´ë¦„ ë˜ëŠ” í•™ì ë²ˆí˜¸ ì…ë ¥ (ì˜ˆ: ê¹€ì² ìˆ˜ ë˜ëŠ” S00042)"
        value={query}
        onChange={(e) => setQuery(e.target.value)}
      />
      
      <div className="space-y-2">
        {results.map(student => (
          <StudentCard key={student.id} student={student} />
        ))}
      </div>
    </div>
  );
}
```

### 3. ì¶œì„ ì²´í¬ í™”ë©´

```typescript
// app/attendance/check/page.tsx
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';

export default function AttendanceCheck({ students }) {
  const markAttendance = async (studentId: string, status: string) => {
    await supabase.from('attendance_logs').insert({
      student_id: studentId,
      date: new Date().toISOString().split('T')[0],
      status: status
    });
  };
  
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {students.map(student => (
        <button
          key={student.id}
          onClick={() => markAttendance(student.id, 'present')}
          className="p-4 border rounded-lg hover:bg-blue-50 transition-colors"
        >
          <div className="flex items-center gap-3">
            <Avatar>
              <AvatarImage src={student.profile_photo_url} />
              <AvatarFallback>{student.name[0]}</AvatarFallback>
            </Avatar>
            
            <div className="text-left flex-1">
              <div className="font-bold">{student.name}</div>
              <div className="text-sm text-gray-500">
                {student.student_number}
              </div>
            </div>
            
            <Badge variant={student.today_attendance ? 'default' : 'secondary'}>
              {student.today_attendance || 'ë¯¸ì²´í¬'}
            </Badge>
          </div>
        </button>
      ))}
    </div>
  );
}
```

---

## í•™ì ë²ˆí˜¸ ë°œê¸‰ í”„ë¡œì„¸ìŠ¤

### ì‹ ê·œ í•™ìƒ ë“±ë¡

```typescript
// app/admin/students/new/page.tsx
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { supabase } from '@/lib/supabase/client';
import { encrypt } from '@/lib/encryption';

export default function NewStudentForm() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    name: '',
    birthday: '',
    gender: '',
    parent_contact: '',
  });
  
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    try {
      // í•™ìƒ ë°ì´í„° ì‚½ì… (í•™ì ë²ˆí˜¸ëŠ” ìë™ ìƒì„±)
      const { data: newStudent, error } = await supabase
        .from('students')
        .insert({
          name: formData.name,
          birthday: formData.birthday,
          gender: formData.gender,
          parent_contact: encrypt(formData.parent_contact),
          // student_numberëŠ” íŠ¸ë¦¬ê±°ê°€ ìë™ ìƒì„±
        })
        .select()
        .single();
      
      if (error) throw error;
      
      // ì„±ê³µ ì•Œë¦¼
      alert(`ë“±ë¡ ì™„ë£Œ!\ní•™ì ë²ˆí˜¸: ${newStudent.student_number}`);
      
      // í•™ìƒ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
      router.push(`/students/${newStudent.id}`);
    } catch (error) {
      alert('ë“±ë¡ ì‹¤íŒ¨: ' + error.message);
    }
  };
  
  return (
    <form onSubmit={handleSubmit} className="space-y-4 max-w-md">
      <div>
        <Label htmlFor="name">ì´ë¦„ *</Label>
        <Input
          id="name"
          value={formData.name}
          onChange={(e) => setFormData({...formData, name: e.target.value})}
          required
        />
      </div>
      
      <div>
        <Label htmlFor="birthday">ìƒë…„ì›”ì¼ *</Label>
        <Input
          id="birthday"
          type="date"
          value={formData.birthday}
          onChange={(e) => setFormData({...formData, birthday: e.target.value})}
          required
        />
      </div>
      
      <div>
        <Label htmlFor="gender">ì„±ë³„ *</Label>
        <select
          id="gender"
          value={formData.gender}
          onChange={(e) => setFormData({...formData, gender: e.target.value})}
          className="w-full border rounded px-3 py-2"
          required
        >
          <option value="">ì„ íƒí•˜ì„¸ìš”</option>
          <option value="male">ë‚¨</option>
          <option value="female">ì—¬</option>
        </select>
      </div>
      
      <div>
        <Label htmlFor="parent_contact">í•™ë¶€ëª¨ ì—°ë½ì²˜ *</Label>
        <Input
          id="parent_contact"
          type="tel"
          value={formData.parent_contact}
          onChange={(e) => setFormData({...formData, parent_contact: e.target.value})}
          placeholder="010-1234-5678"
          required
        />
      </div>
      
      <Button type="submit" className="w-full">í•™ìƒ ë“±ë¡</Button>
    </form>
  );
}
```

### í•™ì ë²ˆí˜¸ ì¹´ë“œ ì¶œë ¥

```typescript
// components/StudentIDCard.tsx
import { QRCodeSVG } from 'qrcode.react';

export function StudentIDCard({ student }) {
  return (
    <div className="w-[350px] h-[200px] bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl p-6 text-white shadow-xl">
      <div className="flex justify-between items-start mb-4">
        <div>
          <h3 className="text-sm opacity-80">â—‹â—‹êµíšŒ ì£¼ì¼í•™êµ</h3>
          <h2 className="text-2xl font-bold mt-1">í•™ìƒì¦</h2>
        </div>
        <div className="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
          <span className="text-3xl">{student.name[0]}</span>
        </div>
      </div>
      
      <div className="space-y-2">
        <div className="flex justify-between">
          <span className="opacity-80">ì´ë¦„</span>
          <span className="font-bold">{student.name}</span>
        </div>
        <div className="flex justify-between">
          <span className="opacity-80">í•™ì ë²ˆí˜¸</span>
          <span className="font-mono text-lg font-bold">
            {student.student_number}
          </span>
        </div>
        <div className="flex justify-between">
          <span className="opacity-80">ì†Œì†</span>
          <span className="font-bold">{student.current_class?.name}</span>
        </div>
      </div>
      
      <div className="mt-4 pt-4 border-t border-white/20 flex justify-center">
        <div className="bg-white p-2 rounded">
          <QRCodeSVG 
            value={student.student_number} 
            size={60}
            level="M"
          />
        </div>
      </div>
    </div>
  );
}

// ì¸ì‡„ ë²„íŠ¼
export function PrintStudentCard({ student }) {
  const handlePrint = () => {
    const printWindow = window.open('', '', 'width=800,height=600');
    const cardHTML = document.getElementById('student-card').innerHTML;
    
    printWindow.document.write(`
      <html>
        <head>
          <title>í•™ìƒì¦ - ${student.name}</title>
          <style>
            body { margin: 0; padding: 20px; }
            @media print {
              body { margin: 0; }
            }
          </style>
        </head>
        <body>${cardHTML}</body>
      </html>
    `);
    
    printWindow.document.close();
    printWindow.print();
  };
  
  return (
    <div>
      <div id="student-card">
        <StudentIDCard student={student} />
      </div>
      <Button onClick={handlePrint} className="mt-4">
        í•™ìƒì¦ ì¸ì‡„
      </Button>
    </div>
  );
}
```

---

## ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ

### ê³µê°œ ë²”ìœ„ ì„¤ì •

```typescript
// ê³µê°œ ê°€ëŠ¥í•œ ì •ë³´
const publicInfo = {
  student_number: 'S00042',  // âœ… ê³µê°œ
  name: 'ê¹€ì² ìˆ˜',            // âœ… ê³µê°œ
  current_class: 'ì‚¬ë‘ë°˜'     // âœ… ê³µê°œ
};

// ë¹„ê³µê°œ ì •ë³´ (RLSë¡œ ë³´í˜¸)
const privateInfo = {
  birthday: '2015-03-15',           // âŒ ë¹„ê³µê°œ
  parent_contact: '010-1234-5678',  // âŒ ë¹„ê³µê°œ
  address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬...',       // âŒ ë¹„ê³µê°œ
  allergies: ['ë•…ì½©', 'ìš°ìœ ']        // âŒ ë¹„ê³µê°œ
};
```

### RLS ì •ì±… ì„¤ì •

```sql
-- 1. í•™ì ë²ˆí˜¸ì™€ ì´ë¦„ì€ ê°™ì€ ë°˜ í•™ìƒë“¤ë„ ë³¼ ìˆ˜ ìˆìŒ
CREATE POLICY "ë°˜ì›ë¼ë¦¬_ê¸°ë³¸ì •ë³´_ì¡°íšŒ"
  ON students FOR SELECT
  USING (
    -- ê°™ì€ ë°˜ì— ì†í•œ í•™ìƒë“¤
    EXISTS (
      SELECT 1 FROM class_assignments ca1
      JOIN class_assignments ca2 ON ca1.class_id = ca2.class_id
      WHERE ca1.student_id = students.id
        AND ca2.student_id = (
          SELECT student_id FROM student_parents 
          WHERE parent_id = auth.uid()
        )
        AND ca1.end_date IS NULL
        AND ca2.end_date IS NULL
    )
  );

-- 2. ìƒì„¸ ì •ë³´ëŠ” ë‹´ë‹¹ êµì‚¬ë§Œ
CREATE POLICY "ë‹´ë‹¹êµì‚¬_ìƒì„¸ì •ë³´"
  ON students FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM class_assignments ca
      JOIN classes c ON ca.class_id = c.id
      WHERE ca.student_id = students.id
        AND c.main_teacher_id = auth.uid()
        AND ca.end_date IS NULL
    )
  );

-- 3. í•™ë¶€ëª¨ëŠ” ìë…€ ì •ë³´ë§Œ
CREATE POLICY "í•™ë¶€ëª¨_ìë…€ì •ë³´"
  ON students FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM student_parents
      WHERE student_id = students.id
        AND parent_id = auth.uid()
    )
  );
```

### ê°œì¸ì •ë³´ ì•”í˜¸í™”

```typescript
// lib/encryption.ts
import crypto from 'crypto';

const ENCRYPTION_KEY = process.env.ENCRYPTION_KEY!; // 32 bytes
const ALGORITHM = 'aes-256-gcm';

export function encrypt(text: string): string {
  const iv = crypto.randomBytes(16);
  const cipher = crypto.createCipheriv(
    ALGORITHM, 
    Buffer.from(ENCRYPTION_KEY, 'hex'), 
    iv
  );
  
  let encrypted = cipher.update(text, 'utf8', 'hex');
  encrypted += cipher.final('hex');
  
  const authTag = cipher.getAuthTag();
  
  return `${iv.toString('hex')}:${authTag.toString('hex')}:${encrypted}`;
}

export function decrypt(encryptedData: string): string {
  const [ivHex, authTagHex, encrypted] = encryptedData.split(':');
  
  const decipher = crypto.createDecipheriv(
    ALGORITHM,
    Buffer.from(ENCRYPTION_KEY, 'hex'),
    Buffer.from(ivHex, 'hex')
  );
  
  decipher.setAuthTag(Buffer.from(authTagHex, 'hex'));
  
  let decrypted = decipher.update(encrypted, 'hex', 'utf8');
  decrypted += decipher.final('utf8');
  
  return decrypted;
}
```

---

## í†µê³„ í™œìš©

### ì—°ë„ë³„ ì‹ ê·œ ë“±ë¡ í†µê³„

```sql
-- ìˆœì°¨ë²ˆí˜¸ ë°©ì‹ì—ì„œì˜ í†µê³„
SELECT 
  EXTRACT(YEAR FROM initial_registration_date) as year,
  COUNT(*) as new_students
FROM students
GROUP BY year
ORDER BY year DESC;
```

```typescript
// ëŒ€ì‹œë³´ë“œ ì°¨íŠ¸
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip } from 'recharts';

export function NewStudentChart({ data }) {
  return (
    <BarChart width={600} height={300} data={data}>
      <CartesianGrid strokeDasharray="3 3" />
      <XAxis dataKey="year" />
      <YAxis />
      <Tooltip />
      <Bar dataKey="new_students" fill="#3b82f6" />
    </BarChart>
  );
}
```

### ë¶€ì„œë³„ ì¬í•™ìƒ ë¶„í¬

```sql
SELECT 
  d.name as department,
  COUNT(DISTINCT s.id) as student_count
FROM students s
JOIN class_assignments ca ON s.id = ca.student_id
JOIN classes c ON ca.class_id = c.id
JOIN departments d ON c.department_id = d.id
WHERE s.is_active = true
  AND ca.end_date IS NULL
GROUP BY d.name
ORDER BY student_count DESC;
```

### í•™ì ë²ˆí˜¸ ë²”ìœ„ ì¡°íšŒ

```typescript
// íŠ¹ì • ë²”ìœ„ì˜ í•™ìƒ ì¡°íšŒ
async function getStudentsByNumberRange(start: string, end: string) {
  const { data } = await supabase
    .from('students')
    .select('*')
    .gte('student_number', start)
    .lte('student_number', end)
    .order('student_number');
  
  return data;
}

// ì‚¬ìš© ì˜ˆì‹œ
const students2024 = await getStudentsByNumberRange('S00100', 'S00200');
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

### ê¸°ì¡´ í•™ìƒì—ê²Œ í•™ì ë²ˆí˜¸ ë¶€ì—¬

```typescript
// scripts/assign-student-numbers.ts
import { supabase } from '@/lib/supabase/client';

async function assignStudentNumbers() {
  // 1. í•™ì ë²ˆí˜¸ê°€ ì—†ëŠ” í•™ìƒ ì¡°íšŒ
  const { data: students } = await supabase
    .from('students')
    .select('id, name, created_at')
    .is('student_number', null)
    .order('created_at'); // ë“±ë¡ì¼ìˆœ
  
  console.log(`${students.length}ëª…ì˜ í•™ìƒì—ê²Œ í•™ì ë²ˆí˜¸ ë¶€ì—¬ ì‹œì‘...`);
  
  // 2. ìˆœì°¨ì ìœ¼ë¡œ í•™ì ë²ˆí˜¸ ë¶€ì—¬
  for (let i = 0; i < students.length; i++) {
    const student = students[i];
    const studentNumber = generate_student_number(); // í•¨ìˆ˜ í˜¸ì¶œ
    
    await supabase
      .from('students')
      .update({ student_number: studentNumber })
      .eq('id', student.id);
    
    console.log(`${i + 1}/${students.length}: ${student.name} â†’ ${studentNumber}`);
  }
  
  console.log('ì™„ë£Œ!');
}

// ì‹¤í–‰
assignStudentNumbers();
```

---

## êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„°ë² ì´ìŠ¤
- [ ] `students` í…Œì´ë¸”ì— `student_number` ì»¬ëŸ¼ ì¶”ê°€
- [ ] ì‹œí€€ìŠ¤ ìƒì„± (`student_number_seq`)
- [ ] ìë™ ìƒì„± í•¨ìˆ˜ ì‘ì„± (`generate_student_number`)
- [ ] íŠ¸ë¦¬ê±° ì„¤ì • (`auto_student_number`)
- [ ] ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ ì¶”ê°€
- [ ] ì¸ë±ìŠ¤ ìƒì„±

### UI ì»´í¬ë„ŒíŠ¸
- [ ] í•™ìƒ ì¹´ë“œ ì»´í¬ë„ŒíŠ¸
- [ ] ê²€ìƒ‰ ê¸°ëŠ¥ (ì´ë¦„ + í•™ì ë²ˆí˜¸)
- [ ] ì¶œì„ ì²´í¬ í™”ë©´ì— í•™ì ë²ˆí˜¸ í‘œì‹œ
- [ ] í•™ìƒ ìƒì„¸ í˜ì´ì§€
- [ ] í•™ì ë²ˆí˜¸ ì¹´ë“œ ì¶œë ¥ ê¸°ëŠ¥

### ê´€ë¦¬ ê¸°ëŠ¥
- [ ] ì‹ ê·œ í•™ìƒ ë“±ë¡ í¼
- [ ] í•™ì ë²ˆí˜¸ ìë™ ë°œê¸‰ í™•ì¸
- [ ] í•™ì ë²ˆí˜¸ ìˆ˜ë™ ìˆ˜ì • (ê´€ë¦¬ì ì „ìš©)
- [ ] ì¤‘ë³µ í•™ì ë²ˆí˜¸ ê²€ì¦
- [ ] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

### ë³´ì•ˆ
- [ ] RLS ì •ì±… ì„¤ì •
- [ ] ê°œì¸ì •ë³´ ì•”í˜¸í™” (ì „í™”ë²ˆí˜¸, ì£¼ì†Œ)
- [ ] ê¶Œí•œë³„ ì ‘ê·¼ ì œì–´
- [ ] ê°ì‚¬ ë¡œê·¸ ê¸°ë¡

### í†µê³„ ë° ë¦¬í¬íŠ¸
- [ ] ì—°ë„ë³„ ì‹ ê·œ ë“±ë¡ í†µê³„
- [ ] ë¶€ì„œë³„ í•™ìƒ ë¶„í¬
- [ ] í•™ì ë²ˆí˜¸ ë²”ìœ„ ì¡°íšŒ ê¸°ëŠ¥

---

## ê²°ë¡ 

### ìµœì¢… ê¶Œì¥ ì‚¬í•­

**ìˆœì°¨ë²ˆí˜¸ ë°©ì‹ (S00001)**ì„ ì¶”ì²œí•˜ëŠ” ì´ìœ :

1. âœ… **ê°„ë‹¨í•¨** - êµ¬í˜„ ë° ê´€ë¦¬ ìš©ì´
2. âœ… **ì•ˆì •ì„±** - ì˜êµ¬ ë¶ˆë³€, ë¶€ì„œ ì´ë™ ë¬´ê´€
3. âœ… **ì‹¤ìš©ì„±** - ë°œìŒí•˜ê¸° ì‰¬ì›€
4. âœ… **í™•ì¥ì„±** - 99,999ëª…ê¹Œì§€ ìˆ˜ìš©
5. âœ… **ìë™í™”** - ì‹œí€€ìŠ¤ë¡œ ìë™ ìƒì„±

### êµ¬í˜„