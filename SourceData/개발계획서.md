--------------------------------------------------------------------------------
# 📱 차세대 주일학교 교적부 웹 애플리케이션 개발 기획서 (Project NewGen)

## 1. 프로젝트 개요
본 프로젝트는 기존 종이 교적부와 엑셀의 한계(데이터 파편화, 비실시간성, 행정 과부하)를 극복하고, **'데이터 기반의 목회적 돌봄(Pastoral Care)'**을 실현하기 위한 웹 애플리케이션 구축을 목표로 합니다.

*   **핵심 비전:** "행정은 간소하게, 사역은 깊이 있게" [1, 2]
*   **개발 방법론:** **바이브코딩(Vibe Coding)** - 1인 개발자나 소규모 팀이 AI와 협업하여 엔터프라이즈급 시스템 구축 [2, 3].
*   **디자인 철학 (Hybrid Strategy):** [4-6]
    *   **Look & Feel:** *Planning Center*의 현대적이고 부드러운 파스텔톤 디자인.
    *   **UX Flexibility:** *Breeze ChMS*의 위젯 대시보드 및 커스텀 필드.
    *   **Korean Context:** *디모데(Dimode)*의 계층적 조직 구조(트리 뷰) 및 심방 디테일.

### 1.1 MVP 범위 명확화

**Phase 1 (MVP) - 파일럿 단계:**
*   **FEAT-1: 스마트 출석 체크** (최우선) - 교사가 모바일에서 터치 한 번으로 출석 처리
*   **FEAT-2: 학생/교사 프로필 관리** (기본) - 기본 정보 입력 및 조회, RLS 보안 적용
*   **FEAT-3: 심방 기록** (기본) - 심방 이력 기록 및 타임라인 조회
*   **Out-of-scope:** 게이미피케이션, 통계 리포트, 학부모 포털, 자동 등반 시스템

**Phase 2 (v2) - 확장 단계:**
*   **FEAT-4: 게이미피케이션** - 디지털 달란트 및 배지 시스템
*   통계 리포트 및 대시보드
*   자동 등반 시스템 (드래그 앤 드롭)

**Phase 3 (v3) - 전면 개방:**
*   학부모 포털 오픈
*   달란트 상점 및 가정 연계 기능

### 1.2 성공 지표 (KPI)

**노스스타 지표 (North Star Metric):**
*   매주 출석 체크를 하는 교사 비율 **80% 이상**

**입력 지표 (Input Metrics):**
*   주간 활성 사용자 수 (WAU) - 주 1회 이상 로그인한 교사 수
*   출석 기록 건수 - 일일 평균 출석 처리 건수
*   심방 기록 건수 - 주간 평균 심방 기록 건수
*   평균 출석 처리 시간 - 목표: **3초 이내** (모바일 기준)

---

## 2. 사용자 페르소나 (User Persona)

### 2.1 주요 페르소나: "바쁜 김교사"

| 항목 | 내용 |
|------|------|
| **이름/별칭** | 바쁜 김교사 |
| **나이/직업** | 35세, 유년부 3학년 담임 교사 |
| **기술 수준** | 스마트폰 기본 사용 가능 (카카오톡, 유튜브 사용) |
| **핵심 니즈** | 출석 체크를 **5분 안에** 끝내고 싶음. 학생 이탈 조짐을 놓치지 않고 싶음 |
| **불편 포인트** | 종이 출석부 작성이 귀찮고, 나중에 찾기 어려움. 엑셀로 관리하려니 복잡함 |
| **사용 상황** | 주일 오전 9시, 교실에서 스마트폰으로 출석 체크. 평일 저녁, 집에서 심방 기록 |
| **동기** | 사역의 본질인 '돌봄'에 집중하고 싶지만 행정 업무에 시간을 빼앗김 |

### 2.2 페르소나의 하루 (시나리오)

**주일 오전 9:00 - 출석 체크**
1. 스마트폰으로 앱 로그인
2. "유년부 > 3학년 > 사랑반" 선택
3. 학생 카드 목록 확인
4. 출석한 학생 카드 터치 → 즉시 체크 완료
5. 결석한 학생 카드 터치 → "아픔" 사유 선택
6. **3분 만에 출석 체크 완료!** (기존 10분 → 3분)

**평일 저녁 8:00 - 심방 기록**
1. "장기 결석 알림" 확인 (3주 이상 결석 학생)
2. 전화 심방 후 앱에서 기록
3. 기도 제목 입력: "가정 문제로 힘들어함"
4. 다음 심방 일정 설정

### 2.3 보조 페르소나: "관심 많은 이학부모"

| 항목 | 내용 |
|------|------|
| **이름/별칭** | 관심 많은 이학부모 |
| **나이/직업** | 40세, 직장인 |
| **핵심 니즈** | 아이의 출석 상황을 실시간으로 알고 싶음 |
| **사용 상황** | 주일 오후, 아이 출석 알림 확인 (v3에서 학부모 포털 오픈) |

---

## 3. 사용자 흐름도 (User Flow)

### 3.1 핵심 시나리오: 출석 체크

```
[로그인] 
  ↓
[대시보드] - "오늘 출석 체크하기" 버튼
  ↓
[반 선택] - 사이드바에서 "유년부 > 3학년 > 사랑반" 클릭
  ↓
[학생 리스트] - 카드 형태로 표시 (모바일 최적화)
  ↓
[출석 처리] - 학생 카드 터치
  ├─ 출석 → 즉시 체크 완료 (초록색 테두리)
  └─ 결석 → 사유 선택 팝업 (아픔/여행/늦잠)
  ↓
[완료] - "오늘 출석 체크 완료! 🎉" 메시지
```

### 3.2 핵심 시나리오: 심방 기록

```
[학생 프로필] - 특정 학생 클릭
  ↓
[심방 탭] - "새 심방 기록" 버튼
  ↓
[심방 기록 폼]
  - 날짜 선택
  - 유형 선택 (전화/심방/카카오톡)
  - 내용 입력
  - 기도 제목 입력
  - 비밀 보장 체크 (필요 시)
  ↓
[저장] - 타임라인에 추가됨
```

### 3.3 핵심 시나리오: 장기 결석 알림

```
[대시보드] - "알림" 배지 표시
  ↓
[알림 목록] - "김철수 학생이 3주째 결석 중입니다"
  ↓
[학생 프로필] - 자동으로 해당 학생 페이지로 이동
  ↓
[심방 기록] - 즉시 심방 기록 가능
```

---

## 4. 기술 스택 (Tech Stack) [7, 8]
AI가 가장 코드를 잘 생성하고, 생산성과 안정성이 검증된 'Modern Tech Stack'을 사용합니다.

| 구분 | 기술 스택 | 설명 |
| :--- | :--- | :--- |
| **Frontend** | **Next.js 15 (App Router)** | 서버 컴포넌트 활용, Vercel 배포 최적화. |
| **Language** | **TypeScript** | 정적 타입 지정을 통한 안정성 확보. |
| **Styling** | **Tailwind CSS** | 유틸리티 퍼스트, AI 코드 생성 최적화. |
| **UI Library** | **Shadcn/UI** | 커스터마이징이 용이한 Headless 컴포넌트. |
| **Backend / DB** | **Supabase** | PostgreSQL 기반, Auth, Realtime, RLS 보안 내장. |
| **State (Server)** | **TanStack Query** | 서버 데이터 캐싱 및 동기화 표준. |
| **State (Client)** | **Zustand** | 가볍고 직관적인 클라이언트 상태 관리. |

---

## 5. 데이터베이스 스키마 설계 (Database Schema) [9-12]
Supabase PostgreSQL에 적용할 핵심 테이블 구조입니다.

### 3.1 `profiles` (사용자/교사)
Supabase Auth와 1:1 매핑되는 사용자 확장 테이블입니다.
*   **Columns:** `id`(FK), `email`, `role` (enum: admin, teacher, parent), `full_name`, `phone_number`, `department_id`, `avatar_url`

### 3.2 `students` (학생 정보)
*   **Columns:** `id`, `name`, `birthday`, `gender`, `school_name`, `grade`, `parent_contact`, `address`, `allergies` (JSONB), `is_active`
*   **Note:** 알레르기 등 가변 정보는 JSONB로 처리하여 유연성 확보 [10].

### 3.3 `classes` (반 정보)
*   **Columns:** `id`, `name` (예: 사랑반), `department` (예: 유년부), `year` (2025), `main_teacher_id` (FK)
*   **Logic:** 연도(`year`) 컬럼을 두어 매년 반이 바뀌어도 과거 데이터를 보존 [10].

### 3.4 `attendance_logs` (출석 기록)
*   **Columns:** `id`, `student_id`, `class_id`, `date`, `status` (enum: present, absent, late), `reason` (태그: 아픔, 여행 등)
*   **Constraint:** (`student_id`, `date`) 유니크 제약조건 설정 [11].

### 3.5 `visitation_logs` (심방 기록) - **한국적 특화 기능**
*   **Columns:** `id`, `student_id`, `teacher_id`, `visit_date`, `type` (enum: call, visit, kakao), `content`, `prayer_request`, `is_confidential` (boolean)
*   **Security:** `is_confidential`이 true일 경우 담당 교역자만 조회 가능하도록 RLS 적용 [11].

### 3.6 `talent_transactions` (달란트 장부)
*   **Columns:** `id`, `student_id`, `amount` (+/-), `category` (출석, 암송, 마켓사용), `created_at` [12].

---

## 6. 핵심 기능 명세 (Feature Requirements)

### 6.1 스마트 출석 체크 (Smart Attendance) [13-15]
*   **모바일 퍼스트 UI:** 교사가 스마트폰에서 학생 카드를 보고 터치 한 번으로 출석/결석 처리.
*   **QR/바코드 시스템:** 학생이 키오스크에 QR을 찍으면 10초 내 출석 처리 및 부모 알림 발송.
*   **사유 태그:** 결석 선택 시 '아픔', '여행', '늦잠' 등 사유를 팝업으로 선택.
*   **알림 시스템:**
    *   **채널:** 앱 내 알림 (MVP), SMS/카카오톡 (v2)
    *   **타이밍:** 출석 즉시, 3주 이상 결석 시 자동 경고
    *   **형식:** "김철수 학생이 오늘 출석했습니다 🙏" (재미있고 활기찬 톤)

### 6.2 계층적 조직 관리 (Tree View) [16, 17]
*   **구조:** 교구 > 부서(유년부) > 학년(1학년) > 반(1반) 구조의 트리 뷰 제공.
*   **기능:** 사이드바에서 특정 조직을 클릭하면 해당 그룹 학생 리스트로 필터링 (Drill-down 방식).

### 6.3 목회적 돌봄 및 심방 (Pastoral Care) [18-20]
*   **심방 타임라인:** 학생 개인별 심방 이력을 시간순(Timeline) UI로 시각화.
*   **장기 결석 알림:** 3주 이상 결석 학생 자동 추출 및 담당 교사에게 '골든타임' 경고 알림 [21].

### 6.4 게이미피케이션 (Gamification) [22, 23] - Phase 2
*   **디지털 달란트:** 출석(+), 암송(+) 시 포인트 자동 적립 및 실시간 잔액 조회.
*   **성취 배지:** '4주 개근', '전도왕' 등 배지 시스템으로 동기 부여.

---

## 7. 디자인 시스템 (Design System)

### 7.1 색상 팔레트

| 용도 | 색상 코드 | 설명 |
|------|----------|------|
| **Primary (파스텔 블루)** | `#3B82F6` | 주요 버튼, 링크, 강조 요소 |
| **Secondary (앰버)** | `#F59E0B` | 보조 버튼, 배지, 포인트 표시 |
| **Success (초록)** | `#10B981` | 출석 완료, 성공 메시지 |
| **Warning (노랑)** | `#F59E0B` | 경고, 주의 사항 |
| **Error (빨강)** | `#EF4444` | 오류, 결석 표시 |
| **Background** | `#F9FAFB` | 배경색 (밝은 회색) |
| **Text Primary** | `#111827` | 주요 텍스트 |
| **Text Secondary** | `#6B7280` | 보조 텍스트 |

### 7.2 타이포그래피

*   **폰트:** Pretendard (한글 최적화 웹폰트)
*   **제목 (H1):** `text-3xl font-bold` (30px, 굵게)
*   **제목 (H2):** `text-2xl font-semibold` (24px, 중간 굵게)
*   **본문:** `text-base` (16px, 기본)
*   **작은 텍스트:** `text-sm` (14px)

### 7.3 간격 시스템

*   **기준 단위:** 4px (Tailwind 기본)
*   **카드 패딩:** `p-4` (16px)
*   **섹션 간격:** `mb-6` (24px)
*   **요소 간격:** `gap-4` (16px)

### 7.4 컴포넌트 스타일

*   **Border Radius:** `rounded-lg` (8px) - 모든 카드, 버튼
*   **그림자:** `shadow-sm` - 카드, `shadow-md` - 모달
*   **호버 효과:** `hover:bg-blue-50` - 버튼, 링크
*   **모바일 최적화:** 모든 테이블은 모바일에서 카드 형태로 변환

### 7.5 톤앤매너

*   **말투:** 재미있고 활기찬 느낌 (게이미피케이션)
*   **예시:**
    *   "오늘 출석 체크 완료! 🎉"
    *   "와! 오늘 출석률 100%!"
    *   "김철수 학생이 오늘 출석했습니다 🙏"
*   **금지 표현:** 딱딱한 공식 용어, 번역체

---

## 8. 보안 및 권한 관리 (Security & RLS) [12, 24, 25]
Supabase의 **RLS(Row Level Security)** 를 통해 애플리케이션이 아닌 DB 레벨에서 보안을 강제합니다.

1.  **교사 (`teacher`):** 자신이 담당하는 반(`class_id`)의 학생 정보만 `SELECT` 가능.
2.  **학부모 (`parent`):** 자신의 자녀(`parent_contact` 일치) 정보만 조회 가능.
3.  **관리자 (`admin`):** 모든 데이터 접근 및 `visitation_logs`의 `is_confidential` 내용 열람 가능.

---

## 9. 비기능 요구사항 (Non-Functional Requirements)

### 9.1 성능 요구사항

*   **출석 처리 시간:** 모바일에서 **3초 이내** 완료 (목표)
*   **페이지 로딩:** 초기 로딩 **2초 이내** (Next.js 서버 컴포넌트 활용)
*   **데이터 동기화:** Optimistic Update로 즉각적인 UI 반응
*   **오프라인 지원:** 기본 기능은 오프라인에서도 동작 (Service Worker, v2)

### 9.2 보안 요구사항

*   **데이터 격리:** Supabase RLS로 DB 레벨 보안 강제
*   **인증:** Supabase Auth (이메일/비밀번호, 소셜 로그인 v2)
*   **민감 정보 보호:** `is_confidential` 필드로 심방 내용 보호
*   **HTTPS:** 모든 통신 암호화 (Vercel 자동 적용)

### 9.3 접근성 요구사항

*   **WCAG 2.1 AA 준수:** 색상 대비율, 키보드 네비게이션
*   **모바일 최적화:** 터치 영역 최소 44x44px
*   **한글 최적화:** Pretendard 폰트로 가독성 향상

### 9.4 가용성 요구사항

*   **목표:** 99% 이상 (Supabase 무료 플랜 한도 내)
*   **모니터링:** Vercel Analytics로 성능 추적
*   **에러 처리:** 사용자 친화적인 에러 메시지 표시

---

## 10. 리스크 관리 (Risk Management)

### 10.1 Top 3 리스크

| 순위 | 리스크 | 영향도 | 발생 확률 | 완화 방안 |
|------|--------|--------|----------|----------|
| **1** | 교사들의 디지털 기기 익숙도 차이 | 높음 | 중간 | 극도로 단순한 UI (1~2번 터치로 완료), 온보딩 튜토리얼 (첫 사용 시 3분 가이드) |
| **2** | 데이터 마이그레이션 실패 (기존 종이/엑셀 → 시스템) | 중간 | 낮음 | 엑셀 템플릿 제공, 일괄 업로드 기능 (v2), 수동 입력 가이드 |
| **3** | 초기 사용자 이탈 (파일럿 단계) | 중간 | 중간 | 파일럿 단계에서 지속적인 피드백 수집, 빠른 버그 수정, 교사 교육 세션 |

### 10.2 완화 전략

**리스크 1 완화:**
*   첫 로그인 시 인터랙티브 튜토리얼 제공
*   "도움말" 버튼을 항상 접근 가능한 위치에 배치
*   파일럿 단계에서 디지털 기기 익숙도 낮은 교사 1~2명 테스트

**리스크 2 완화:**
*   엑셀 → CSV 변환 가이드 제공
*   데이터 검증 로직으로 오류 사전 방지
*   백업 기능으로 데이터 손실 방지

**리스크 3 완화:**
*   주간 피드백 수집 (구글 폼)
*   24시간 내 버그 수정 (MVP 단계)
*   성공 사례 공유로 동기 부여

---

## 11. 바이브코딩 설정을 위한 `.cursorrules` [25-27]
AI에게 프로젝트의 문맥을 주입하기 위해 프로젝트 루트에 아래 내용을 저장하세요.

```markdown
# Project Context
You are an expert Full-stack Developer (Next.js 15, Supabase, Tailwind).
Building: "Korean Church Sunday School Management System".

# Language Rules
1. UI Text: MUST be in Natural Korean (Hangul).
   - "Student" -> "학생"
   - "Class" -> "반"
   - "Visitation" -> "심방"
   - "Teacher" -> "교사"
2. Tone: Polite and warm (해요체).

# Design Principles
- Mobile-First: All tables must transform to cards on mobile.
- Clean & Holy: Use Pastel Blue/Amber colors. rounded-lg.
- Input: Use 'Shadcn/UI' components.

# Database
- Always check 'RLS policies' when writing queries.
- Use 'optimistic updates' for attendance toggle to ensure speed.

---

## 12. 단계별 개발 및 도입 로드맵

### 12.1 Phase 1 (파일럿) - MVP

**기간:** 2~3개월
**대상:** 소규모 부서 (고등부 등, 교사 3~5명)

**핵심 기능:**
*   FEAT-1: 스마트 출석 체크 (모바일 퍼스트)
*   FEAT-2: 학생/교사 프로필 관리 (기본)
*   FEAT-3: 심방 기록 및 타임라인

**목표:**
*   출석 체크 시간 50% 단축 (10분 → 5분)
*   교사 만족도 4점 이상 (5점 만점)
*   버그 수정 및 안정화

### 12.2 Phase 2 (확장)

**기간:** 1~2개월
**대상:** 전체 주일학교 교사

**추가 기능:**
*   FEAT-4: 게이미피케이션 (디지털 달란트, 배지)
*   통계 리포트 및 대시보드
*   자동 등반 시스템 (드래그 앤 드롭)

**목표:**
*   주간 활성 사용자 비율 80% 달성
*   데이터 기반 목회 의사결정 지원

### 12.3 Phase 3 (전면 개방)

**기간:** 2~3개월
**대상:** 학부모 포함 전체 생태계

**추가 기능:**
*   학부모 포털 오픈
*   달란트 상점 및 가정 연계 기능
*   SMS/카카오톡 알림 연동

**목표:**
*   "한 영혼을 놓치지 않는 통합 목회 플랫폼" 완성

---

## 결론

이 계획서는 단순히 출석을 체크하는 도구를 넘어, 데이터를 통해 **"한 영혼을 놓치지 않는 통합 목회 플랫폼"**을 구축하는 것을 목표로 합니다. 제공된 소스의 기술 스택과 바이브코딩 전략을 따르면 개발 비용과 시간을 획기적으로 단축할 수 있습니다.

**다음 단계:** 이 기획서를 바탕으로 6개의 구조화된 기획 문서(PRD, TRD, User Flow, Database Design, Design System, Coding Convention)를 생성하여 AI 코딩 파트너가 바로 개발을 시작할 수 있도록 합니다.